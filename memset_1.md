**–í–∞—à–∏ –ø–∞—Ä–æ–ª–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è. –î–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.** üî•

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `memset()` –¥–ª—è –∑–∞—Ç–∏—Ä–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–µ–π, –∫–ª—é—á–µ–π) –≤ –ø–∞–º—è—Ç–∏. –ù–æ —ç—Ç–æ ‚Äî **–≥—Ä—É–±–∞—è –æ—à–∏–±–∫–∞**.

–û–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—â–∏–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (GCC, Clang) –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å—Ç—É **–≤—ã–∫–∏–Ω—É—Ç—å —ç—Ç–æ—Ç –≤—ã–∑–æ–≤ `memset`**, –µ—Å–ª–∏ —Å–æ—á—Ç–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –í–∞—à –ø–∞—Ä–æ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, –≥–æ—Ç–æ–≤—ã–π –¥–ª—è —É—Ç–µ—á–∫–∏.

---

### ‚ùì –ü–æ—á–µ–º—É `memset()` ‚Äî —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å?

–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –≤ **–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞**.

1.  **–í–∞—à–∞ –ª–æ–≥–∏–∫–∞:** –í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ `memset(buf, 0, size)`, —á—Ç–æ–±—ã –∑–∞—Ç–µ—Ä–µ—Ç—å –ø–∞—Ä–æ–ª—å.
2.  **–õ–æ–≥–∏–∫–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞** (GCC/Clang —Å —Ñ–ª–∞–≥–∞–º–∏ `-O2`, `-O3`): –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤–∏–¥–∏—Ç, —á—Ç–æ –ø–æ—Å–ª–µ –∑–∞—Ç–∏—Ä–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ `buf` –±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è. –û–Ω —Ä–µ—à–∞–µ—Ç, —á—Ç–æ —ç—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è —Ç—Ä–∞—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (*dead store*), –∏ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –≤—ã–∑–æ–≤ `memset()`** –∏–∑ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∞—à –ø–∞—Ä–æ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º –≤–∏–¥–µ, –∞ –≤—ã –¥–∞–∂–µ –Ω–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –µ–≥–æ —Å—Ç–µ—Ä–µ—Ç—å, –±—ã–ª–∞ –≤—ã–∫–∏–Ω—É—Ç–∞ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

```c
char password[100];
// ... –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª—å ...
memset(password, 0, sizeof(password)); // <- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –£–î–ê–õ–ò–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É
```

---

### üîç –°–º–æ—Ç—Ä–∏–º –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä

**–ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** ‚Äî –≤—Å—ë –∏–¥—ë—Ç –ø–æ –ø–ª–∞–Ω—É, –≤—ã–∑–æ–≤ `memset` –µ—Å—Ç—å:
```asm
	call	memset@PLT
	nop
```

**–° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π** ‚Äî –≤—ã–∑–æ–≤ `memset` **–±–µ—Å—Å–ª–µ–¥–Ω–æ –∏—Å—á–µ–∑**, –Ω–æ –∑–∞—Ç–æ –≤ —Å–µ–∫—Ü–∏–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –º—ã –Ω–∞—Ö–æ–¥–∏–º:
```asm
.LC1:
	.quad	8032015399829666125  <-- 1 —á–∞—Å—Ç—å –ø–∞—Ä–æ–ª—è
	.quad	219885429874         <-- 2 —á–∞—Å—Ç—å –ø–∞—Ä–æ–ª—è
```

---

### üß© –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —á–∏—Å–ª–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–∞—Ä–æ–ª—å

1.  **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ HEX:**
    *   `8032015399829666125` ‚Üí `0x6F7773736150794D`
    *   `219885429874` ‚Üí `0x0000003332316472`

2.  **–†–∞–∑–±–∏—Ä–∞–µ–º –±–∞–π—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ Little-endian:**
    *   –ò–∑ `0x6F7773736150794D` ‚Üí `4D 79 50 61 73 73 77 6F`
    *   –ò–∑ `0x0000003332316472` ‚Üí `72 64 31 32 33 00 00 00`

3.  **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º HEX –≤ ASCII:**
    *   `4D` ‚Üí M, `79` ‚Üí y, `50` ‚Üí P, `61` ‚Üí a, `73` ‚Üí s, `73` ‚Üí s, `77` ‚Üí w, `6F` ‚Üí o
    *   `72` ‚Üí r, `64` ‚Üí d, `31` ‚Üí 1, `32` ‚Üí 2, `33` ‚Üí 3, `00` ‚Üí \0

**–ò—Ç–æ–≥:** `MyPassword123`

–ü–∞—Ä–æ–ª—å **–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –≤—à–∏—Ç** –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –≤ –≤–∏–¥–µ —á–∏—Å–ª–æ–≤–æ–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã!

---

### ‚öîÔ∏è –ê—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ `LD_PRELOAD`

–£—è–∑–≤–∏–º–æ—Å—Ç—å: (–≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö glibc)
```
  #ifndef MEMSET
  # define MEMSET memset
  #endif
```

–û—Å–Ω–æ–≤–Ω–∞—è —Å—É—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ ‚Äî –Ω–µ –≤ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `memset`, –∞ –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –µ—ë –≤—ã–∑–æ–≤ —Å –ø–æ–º–æ—â—å—é –ø–æ–¥–º–µ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `LD_PRELOAD`.

**–ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞:**
```bash
gcc -shared -fPIC -o stealth_memset.so stealth_memset.c -ldl
```

–ö—Ä–∞—Ç–∫–æ —Ä–∞–∑–±–µ—Ä–µ–º –∫–∞–∂–¥—ã–π —Ñ–ª–∞–≥ –∫–æ–º–∞–Ω–¥—ã:

**`gcc`** ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (GNU Compiler Collection).

**`-shared`**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–±–∏—Ä–∞–µ—Ç **—Ä–∞–∑–¥–µ–ª—è–µ–º—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É** (.so, Shared Object), –∞ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª.
*   **–ê–Ω–∞–ª–æ–≥:** `-static` (–¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ .a).

**`-fPIC`** (Position-Independent Code)
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ **–ª—é–±–æ–º—É –∞–¥—Ä–µ—Å—É** –≤ –ø–∞–º—è—Ç–∏. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Ä–∞–∑–Ω–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º.
*   **–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å:** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ —Å–º–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ `LD_PRELOAD`.

**`-o stealth_memset.so`**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–¥–∞–µ—Ç –∏–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (`-o` = output). –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî `stealth_memset.so`.

**`stealth_memset.c`**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å.

**`-ldl`**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É **`libdl`**.
*   **–ó–∞—á–µ–º:** –í –≤–∞—à–µ–º –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `dlsym()` (–¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ `memset`), –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä—è–≤–ª–µ–Ω–∞ –≤ `dlfcn.h`, –Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `libdl.so`. –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –≥–æ–≤–æ—Ä–∏—Ç –ª–∏–Ω–∫–æ–≤—â–∏–∫—É: "–ø—Ä–∏–ª–∏–Ω–∫—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É `libdl`".


**–ó–∞–ø—É—Å–∫–∞–µ–º —É—è–∑–≤–∏–º—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É:**
```bash
LD_PRELOAD=./stealth_memset.so ./vulnerable_program
```

`LD_PRELOAD` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É –ø–µ—Ä–≤–æ–π, –∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã `memset` –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞—à–µ–π –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç **—Å–Ω–∞—á–∞–ª–∞ —É–∫—Ä–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ**, –∞ —É–∂–µ –ø–æ—Ç–æ–º –≤—ã–∑–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π `memset`.

```bash
LD_PRELOAD=./stealth_memset.so ./test_original
–î–æ memset: my_secret_password_123
–ü–æ—Å–ª–µ memset:
–ë—É—Ñ–µ—Ä –æ—á–∏—â–µ–Ω? : –î–∞
```

---

### ‚úÖ –í—ã–≤–æ–¥

–ú–æ–π –∫–æ–¥ –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ:

1.  `memset` –¥–ª—è –∑–∞—Ç–∏—Ä–∞–Ω–∏—è **–±–µ—Å–ø–æ–ª–µ–∑–µ–Ω**, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä.
2.  –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç **"–ø—Ä–æ—Å–æ—á–∏—Ç—å—Å—è" –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª** –≤ –≤–∏–¥–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç.
3.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∑–∞—Ç–∏—Ä–∞–Ω–∏—è (`explicit_bzero`) ‚Äî —ç—Ç–æ **–Ω–µ –ø—Ä–∏—Ö–æ—Ç—å, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å**. –û–Ω–∏ –ø–æ–º–µ—á–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∫–∞–∫ "–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—É—é", –∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ —Å–º–µ–µ—Ç –µ—ë —É–¥–∞–ª—è—Ç—å.

**–≤—Å–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ (–∫–æ–¥, —Å—Å—ã–ª–∫–∏ –∏ —Ç–¥), –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è (—Ç–∞–º –±—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å —á—Ç–æ —Ç–∞–∫–æ–µ .so, –∫–∞–∫–∏–µ —Ñ–ª–∞–≥–∏ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –¥—è–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ä–∞–∑–±–∏—Ä–∞—Ç—å –∫–∞–∂–¥—É—é —á–∞—Å—Ç–∏—á–∫—É –∏ —Ç–¥), –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º —Ç–≥ –∫–∞–Ω–∞–ª–µ****–í–∞—à–∏ –ø–∞—Ä–æ–ª–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è. –î–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.** üî•
